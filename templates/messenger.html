<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Messages - ZenSocial</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root{
      --bg:#000;
      --card:#0b0f14;
      --card2:#12161b;
      --text:#e6e6e6;
      --muted:#94a3b8;
      --line:#2f3336;
      --accent:#A6FF4D;   /* xanh neon của Zen */
      --link:#1d9bf0;     /* xanh link */
    }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:"Inter",sans-serif; background:var(--bg); color:#fff; }
    .container{ display:grid; grid-template-columns: 18% 32% 50%; height:100vh; }

    /* Sidebar left */
    .sidebar-left{ border-right:1px solid var(--line); padding:20px 15px; display:flex; flex-direction:column; justify-content:space-between; height:100vh; }
    .logo{ display:flex; align-items:center; gap:10px; margin-bottom:30px; }
    .logo i{ font-size:28px; color:var(--accent); }
    .logo span{ font-size:26px; font-weight:700; color:var(--accent); }
    .menu{ display:flex; flex-direction:column; gap:14px; }
    .menu-item{ display:flex; align-items:center; gap:14px; font-size:18px; font-weight:600; padding:12px 15px; border-radius:30px; transition:.2s; cursor:pointer; color:#fff; text-decoration:none; }
    .menu-item i{ width:22px; text-align:center; }
    .menu-item:hover{ background:#181818; color:var(--accent); }
    .menu-item.active{ background:#181818; }
    .menu-item a{ color:inherit; text-decoration:none; display:flex; gap:14px; align-items:center; width:100%; }

    /* Middle: messages list */
    .messages-col{ border-right:1px solid var(--line); display:flex; flex-direction:column; height:100vh; }
    .messages-header{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line); }
    .messages-header h2{ margin:0; font-size:22px; }
    .mh-actions{ display:flex; gap:14px; color:#cbd5e1; }
    .mh-actions i{ cursor:pointer; }
    .search-bar{ padding:10px 12px; }
    .search-wrap{ position:relative; }
    .search-wrap input{ width:100%; padding:10px 12px 10px 38px; background:#16181c; border:1px solid var(--line); border-radius:24px; color:#fff; font-size:14px; }
    .search-wrap i{ position:absolute; top:50%; left:14px; transform:translateY(-50%); color:#8899a6; }
    .list{ overflow-y:auto; }
    .list-section{ padding:8px 0; border-top:1px solid var(--line); }
    .beta-row{ display:flex; align-items:center; justify-content:space-between; padding:10px 16px; color:#cbd5e1; }
    .beta-chip{ border:1px solid var(--line); padding:2px 6px; border-radius:6px; font-size:12px; color:#cbd5e1; }

    .conv{ display:flex; gap:10px; padding:10px 16px; cursor:pointer; transition:.15s; }
    .conv:hover{ background:#16181c; }
    .conv.active{ background:#0e1217; }
    .conv img{ width:44px; height:44px; border-radius:50%; object-fit:cover; }
    .conv-main{ flex:1; min-width:0; }
    .conv-top{ display:flex; justify-content:space-between; align-items:center; }
    .conv-name{ font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .conv-time{ color:#9aa6b2; font-size:12px; }
    .conv-snippet{ color:#9aa6b2; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* Right: message detail or empty */
    .detail-col{ display:flex; flex-direction:column; height:100vh; }
    .detail-empty{ flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; color:#cbd5e1; gap:12px; padding:24px; }
    .detail-empty h2{ color:#fff; margin:0 0 2px 0; letter-spacing:.2px; }

   /*green outline button */
    .btn-ghost{
      background: transparent;
      color: var(--accent);                
      border: 2px solid var(--accent);
      border-radius: 9999px;
      padding: 11px 18px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 0 0 0 rgba(166, 255, 77, 0);
      transition: box-shadow .2s, background .15s, color .15s;
    }
    .btn-ghost:hover{
      background: var(--accent);
      color: #0b0f14;                       /* tối để tương phản */
      box-shadow: 0 0 18px 0 rgba(166, 255, 77, .35);
    }
    .btn-ghost i{ color: inherit; }


    .thread{ display:none; flex-direction:column; height:100%; }
    .thread.show{ display:flex; }
    .thread-header{ display:flex; align-items:center; gap:10px; padding:12px 16px; border-bottom:1px solid var(--line); background:#000; position:sticky; top:0; z-index:2; }
    .thread-header img{ width:36px; height:36px; border-radius:50%; object-fit:cover; }
    .thread-header .name{ font-weight:700; }
    .thread-body{ flex:1; overflow-y:auto; padding:14px 16px; background:#000; }
    .bubble{ max-width:70%; margin-bottom:12px; padding:10px 12px; border-radius:16px; line-height:1.35; font-size:14px; }
    .bubble.me{ margin-left:auto; background:#1f2937; }
    .bubble.them{ background:#111827; border:1px solid #0f172a; }
    .bubble .meta{ color:#93a3b5; font-size:11px; margin-top:6px; }

    .thread-composer{ display:flex; align-items:center; gap:10px; padding:10px 12px; border-top:1px solid var(--line); background:#0b0f14; }
    .composer-input{ flex:1; background:#16181c; border:1px solid var(--line); color:#fff; padding:10px 12px; border-radius:24px; outline:none; }
    .send-btn{ background:var(--accent); color:#000; border:none; border-radius:20px; padding:8px 14px; font-weight:700; cursor:pointer; }
    .send-btn:disabled{ opacity:.6; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar Left -->
    <div class="sidebar-left">
      <div>
        <div class="logo">
          <i class="fas fa-leaf"></i>
          <span>ZenSocial</span>
        </div>
        <div class="menu">
          <a class="menu-item" href="{{ url_for('home') }}"><i class="fas fa-home"></i> <span>Home</span></a>
          <div class="menu-item"><a href="{{ url_for('notifications') }}"><i class="far fa-bell"></i> Notifications</a></div>
          <a class="menu-item active" href="{{ url_for('messenger') }}"><i class="far fa-envelope"></i> <span>Messages</span></a>
          <a class="menu-item" href="{{ url_for('profile') }}"><i class="far fa-user"></i> <span>Profile</span></a>
          <a class="menu-item" href="{{ url_for('earn') }}"><i class="fas fa-coins"></i> <span>Earn</span></a>
          <a class="menu-item" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
        </div>
      </div>
      <!-- Không có nút Post ở sidebar trong trang Messages -->
    </div>

    <!-- Middle: Messages list -->
    <div class="messages-col">
      <div class="messages-header">
        <h2>Messages</h2>
        <div class="mh-actions">
          <i class="fa-solid fa-gear" title="Settings"></i>
          <i class="fa-solid fa-inbox" title="Message requests"></i>
        </div>
      </div>

      <div class="search-bar">
        <div class="search-wrap">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search Direct Messages" />
        </div>
      </div>

      <div class="list">
        <div class="list-section">
          <div class="beta-row">
            <div style="display:flex; align-items:center; gap:10px;">
              <i class="fa-regular fa-message"></i>
              <span>Chat</span>
            </div>
            <span class="beta-chip">Beta</span>
          </div>
        </div>

        <!-- Conversation item: ZenCommunity -->
        <div class="conv" id="conv-zen">
          <!-- ảnh sẽ được set bằng JS để fallback nhiều extension -->
          <img class="zen-avatar" alt="ZenCommunity" />
          <div class="conv-main">
            <div class="conv-top">
              <div class="conv-name">ZenCommunity</div>
              <div class="conv-time">Now</div>
            </div>
            <div class="conv-snippet">Welcome to ZenSocial — this is a demo message from ZenCommunity.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right: Detail / Thread -->
    <div class="detail-col">
      <!-- Empty state (default) -->
      <div class="detail-empty" id="emptyState">
        <h2>Select a message</h2>
        <div style="color:#9aa6b2; text-align:center; max-width:420px;">
          Choose from your existing conversations, start a new one — or just keep swimming.
        </div>
        <button class="btn-ghost" type="button" id="newMsgBtn">
          <i class="fa-regular fa-message" style="margin-right:6px;"></i> New message
        </button>
      </div>

      <!-- Thread -->
      <div class="thread" id="threadZen">
        <div class="thread-header">
          <img class="zen-avatar" alt="ZenCommunity" />
          <div>
            <div class="name">ZenCommunity</div>
            <div style="color:#9aa6b2; font-size:12px;">@zencommunity</div>
          </div>
        </div>

        <div class="thread-body" id="threadBody">
          <!-- Demo message FROM ZenCommunity -->
          <div class="bubble them">
            Hey! Welcome to ZenSocial 👋  
            This is a demo message from <b>ZenCommunity</b>.
            <div class="meta">Now</div>
          </div>
        </div>

        <div class="thread-composer">
          <input type="text" id="msgInput" class="composer-input" placeholder="Start a new message" />
          <button class="send-btn" id="sendBtn" type="button">Send</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Try-load ZenCommunity avatar from multiple possible paths under /static
    function setZenAvatar(imgEl){
      const candidates = [
        "{{ url_for('static', filename='images/zenchain2_bg.png') }}",
        "{{ url_for('static', filename='images/zenchain2_bg.jpg') }}",
        "{{ url_for('static', filename='images/zenchain2_bg.jpeg') }}",
        "{{ url_for('static', filename='images/zenchain2_bg.webp') }}",
        // fallback nếu bạn đặt ảnh ngay dưới /static/
        "{{ url_for('static', filename='zenchain2_bg.png') }}",
        "{{ url_for('static', filename='zenchain2_bg.jpg') }}",
        "{{ url_for('static', filename='zenchain2_bg.jpeg') }}",
        "{{ url_for('static', filename='zenchain2_bg.webp') }}",
        "{{ url_for('static', filename='default_avatar.png') }}"
      ];
      let i = 0;
      function tryNext(){
        if (i >= candidates.length) return;
        imgEl.src = candidates[i++];
      }
      imgEl.addEventListener('error', tryNext);
      tryNext();
    }

    document.querySelectorAll('.zen-avatar').forEach(setZenAvatar);

    // Open thread when clicking conversation
    const convZen = document.getElementById('conv-zen');
    const emptyState = document.getElementById('emptyState');
    const threadZen = document.getElementById('threadZen');

    if (convZen){
      convZen.addEventListener('click', () => {
        document.querySelectorAll('.conv').forEach(el => el.classList.remove('active'));
        convZen.classList.add('active');
        emptyState.style.display = 'none';
        threadZen.classList.add('show');
      });
    }

    // New message button can also open the same demo thread
    document.getElementById('newMsgBtn').addEventListener('click', () => {
      if (convZen) convZen.click();
      document.getElementById('msgInput').focus();
    });

    // Demo send
    const sendBtn = document.getElementById('sendBtn');
    const msgInput = document.getElementById('msgInput');
    const threadBody = document.getElementById('threadBody');

    function sendMessage(){
      const text = msgInput.value.trim();
      if (!text) return;
      const bubble = document.createElement('div');
      bubble.className = 'bubble me';
      bubble.innerHTML = `${text}<div class="meta">Just now</div>`;
      threadBody.appendChild(bubble);
      msgInput.value = '';
      threadBody.scrollTop = threadBody.scrollHeight;
    }
    sendBtn.addEventListener('click', sendMessage);
    msgInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(); } });
  </script>
</body>
</html>
